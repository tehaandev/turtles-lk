<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <title>Book Tickets</title>
        
        <link rel="shortcut icon" href="media/icon.webp" type="image/x-icon">
        <script src="https://unpkg.com/alpinejs" defer></script>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdn.jsdelivr.net/npm/pikaday/pikaday.js"></script>
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/pikaday/css/pikaday.css">
        <script src="https://cdnjs.com/libraries/moment.js"></script>
        <link rel="stylesheet" href="/CSS/ticketStyle.css">
    </head>

    <body>
        <div
        class='custom-bg flex items-center justify-center min-h-screen z-10' 
        x-data="ticket">
            <!-- Alert box -->
            <div 
            x-data="{isWPopUpOpen: true}"
            x-show="isWPopUpOpen" 
            x-transition
            class="fixed flex mx-auto w-max p-4 rounded border-2 border-slate-200 text-sm bg-white inset-0 items-center justify-center h-max my-auto overflow-hidden shadow-2xl"            
            id="alert-box">
                <div>
                    <h2 class="text-3xl py-2">Welcome!</h2>
                    <p>Please click 'Continue' to proceed with the ticketing process.</p>
                    <button
                    type="button"
                    class="w-full py-3 mt-5 font-medium tracking-widest text-white uppercase bg-slate-500 shadow-lg focus:outline-none hover:bg-slate-600 hover:shadow-none duration-200"
                    x-on:click="isWPopUpOpen = !isWPopUpOpen">
                        Continue
                    </button>
                </div>
            </div>
            
            <div
            class="w-max px-10 py-8 mx-auto bg-white shadow-xl max-[815px]:mx-5"
            x-data="{
                    ratesPopUp: false,
                    adult_LK_count: 0,
                    adult_FR_count: 0,
                    child_LK_count: 0,
                    child_FR_count: 0,
                    infant_count: 0,
                    datepicker: '', 
                    total: 0,
                    selectedTime: [],
                    selectedTimeTxt: [], 
                
                    selectTimeSlots(id){
                        if(this.selectedTime.includes(id)){
                            this.selectedTime = this.selectedTime.filter(item => item !== id);
                            this.selectedTimeTxt = this.selectedTimeTxt.filter(item => item !== $store.ticket.timeSlots[id].time);
                            return;
                        }

                        if(this.selectedTime.length > 0){
                            if(this.selectedTime[this.selectedTime.length - 1] !== id - 1 && this.selectedTime[this.selectedTime.length - 1] !== id + 1){
                                alert('Please select consecutive time slots.');
                                this.selectedTime = [];
                                this.selectedTimeTxt = [];
                                return;
                            }
                        }
                        this.selectedTime.push(id);
                        this.selectedTimeTxt.push($store.ticket.timeSlots[id].time);
                        this.calculate();
                    },

                    goToCheckout(){
                    
                        if(localStorage.getItem('selectedDate') === null){
                            alert('Please select a date.');
                            return;
                        }

                        if(this.selectedTime.length === 0){
                            alert('Please select a time slot.');
                            return;
                        }
                        
                        localStorage.setItem('selectedTime', this.selectedTime);
                        localStorage.setItem('selectedTimeTxt', this.selectedTimeTxt);
                        localStorage.setItem('adult_LK_count', this.adult_LK_count);
                        localStorage.setItem('child_LK_count', this.child_LK_count);
                        localStorage.setItem('adult_FR_count', this.adult_FR_count);
                        localStorage.setItem('child_FR_count', this.child_FR_count);
                        localStorage.setItem('infant_count', this.infant_count);
                        window.location.href = '/tickets/checkout.html'; 
                    }
                }">
                <header class="text-center text-3xl p-2 mb-8">
                    <h1>Buy Tickets!</h1>
                </header>
                <div
                class="grid grid-cols-2 max-[815px]:grid-cols-1"
                :class="{'pointer-events-none' : ratesPopUp}">
                    <form
                    action="" 
                    class="text-gray-700  text-bold">
                        <!-- Date picker -->
                        <div class="inline py-5">
                            <label class="text-lg" for="datepicker">When are you coming?</label>
                            <input 
                            class="p-2 mt-2 w-full bg-slate-200 rounded border-2 border-slate-200 focus:border-slate-600 focus:outline-none" 
                            placeholder="DD-MM-YYYY" 
                            id="datepicker" 
                            x-model="datepicker" required></input>
                        </div>

                        <!-- Selecting categories -->
                        <div
                        class="mt-7">
                            <p class="text-bold text-lg" for="">Category/ Categories:</p>

                            <!-- LK Adult Category -->
                            <div class="bg-white mt-2 px-3 grid grid-cols-2 justify-items-center align-middle">
                                <!-- Adult-LK label -->
                                <label 
                                for="adult_LK_count"
                                class="align-middle">
                                    Adult - Resident:
                                </label>

                                <!-- Ticket count -->
                                <input 
                                class="align-middle text-center w-1/2 bg-gray-200 rounded p-2"
                                type="number" 
                                x-model="adult_LK_count"
                                name="adult_LK_count" 
                                id="adult_LK_count" 
                                min="0" max="10">
                            </div>

                            <!-- LK Child Category -->
                            <div class="bg-white mt-2 px-3 grid grid-cols-2 justify-items-center align-middle">
                                <!-- Child LK label -->
                                <label
                                for="child_LK_count"
                                class="align-middle">
                                    Child - Resident:
                            </label>

                                <!-- Ticket count -->
                                <input 
                                class="align-middle text-center w-1/2 bg-gray-200 rounded p-2"
                                type="number" 
                                x-model="child_LK_count"
                                name="child_LK_count" 
                                id="child_LK_count" 
                                min="0" max="10">
                            </div>

                            <!-- FR Adult Category -->
                            <div class="bg-white mt-2 px-3 grid grid-cols-2 justify-items-center align-middle">
                                <!-- Adult-FR label -->
                                <label 
                                for="adult_FR_count"
                                class="align-middle">
                                    Adult - Foreign:
                                </label>

                                <!-- Ticket count -->
                                <input 
                                class="align-middle text-center w-1/2 bg-gray-200 rounded p-2"
                                type="number" 
                                x-model="adult_FR_count"
                                name="adult_FR_count" 
                                id="adult_FR_count" 
                                min="0" max="10">
                            </div>
                            
                            <!-- FR Child Category -->
                            <div class="bg-white mt-2 px-3 grid grid-cols-2 justify-items-center align-middle">
                                <!-- Child-FR label -->
                                <label 
                                for="child_FR_count"
                                class="align-middle">
                                    Child - Foreign:
                                </label>

                                <!-- Ticket count -->
                                <input 
                                class="align-middle text-center w-1/2 bg-gray-200 rounded p-2"
                                type="number" 
                                x-model="child_FR_count"
                                name="child_FR_count" 
                                id="child_FR_count" 
                                min="0" max="10">
                            </div>
                            
                            <!-- Infant Category -->
                            <div class="bg-white mt-2 px-3 grid grid-cols-2 justify-items-center align-middle">
                                <!-- Infant label -->
                                <label 
                                for="infant_count"
                                class="align-middle">
                                    Infant:
                                </label>

                                <!-- Ticket count -->
                                <input 
                                class="align-middle text-center w-1/2 bg-gray-200 rounded p-2"
                                type="number"
                                x-model="infant_count"
                                name="infant_count" 
                                id="infant_count" 
                                min="0" max="10">
                            </div>
                            
                            <!-- Time slot picker -->
                            <label class="text-bold text-lg" for="user_date">Pick your time slot(s):</label>
                            <div class="grid grid-cols-2 gap-y-8 my-5 max-[500px]:grid-cols-1">
                                <template x-for="(timeSlots, id) in $store.ticket.timeSlots">
                                    <div 
                                    x-on:click="selectTimeSlots(timeSlots.id)"
                                    x-bind:class="selectedTime.includes(timeSlots.id) ? 'bg-sky-600' : 'bg-sky-300'"
                                    class="timeSlotBtn grid-cols-1 h-10 w-40 text-white text-center mx-auto align-middle 
                                    flex items-center justify-center hover:cursor-pointer hover:bg-sky-600 duration-200">
                                        <span x-text="timeSlots.time"></span>
                                    </div>
                                </template>
                            </div>
                            <p class="text-xs text-center">
                                NOTE: Multiple <span class="font-bold">consecutive</span> timeslots can be selected.
                            </p>
                        </div>
                    </form>
                    <!-- Summary Table -->
                    <div
                    class="justify-self-center max-[815px]:mt-6">
                        <table
                        class="border-2 table-fixed w-80">
                            <tr>
                                <td colspan="2" class="font-bold border-2 px-2 py-2">Date</td>
                            </tr>
                            <tr>
                                <td colspan="2" class="border-2 px-2 py-2 text-center">
                                    <span id="summary_date">DD-MM-YYYY</span>
                                </td>
                            </tr>
                            <tr>
                               <td class="font-bold border-2 px-2 py-2" colspan="2">Categories</td> 
                            </tr>
                            <tr>
                                <td class="border-2 px-2 py-2">Adult (Resident)</td>
                                <td class="border-2 px-2 py-2 text-center">
                                    <span id="adult_LK_count" x-text="adult_LK_count"></span>
                                </td>
                            </tr>
                            <tr>
                                <td class="border-2 px-2 py-2">Child (Resident)</td>
                                <td class="border-2 px-2 py-2 text-center">
                                    <span id="child_LK_count" x-text="child_LK_count"></span>
                                </td>
                            </tr>
                            <tr>
                                <td class="border-2 px-2 py-2">Adult (Foreign)</td>
                                <td class="border-2 px-2 py-2 text-center">
                                    <span id="adult_FR_count" x-text="adult_FR_count"></span>
                                </td>
                            </tr>
                            <tr>
                                <td class="border-2 px-2 py-2">Child (Foreign)</td>
                                <td class="border-2 px-2 py-2 text-center">
                                    <span id="child_FR_count" x-text="child_FR_count"></span>
                                </td>
                            </tr>
                            <tr>
                                <td class="border-2 px-2 py-2">Infant</td>
                                <td class="border-2 px-2 py-2  text-center">
                                    <span id="infant_count" x-text="infant_count"></span>
                                </td>
                            </tr>
                            <tr>
                                <td class="font-bold border-2 px-2 py-2" colspan="2">Time Slot(s)</td>
                            </tr>
                            <template x-for="time in selectedTimeTxt">
                                <tr>
                                    <td class="text-center border-2 px-1 py-2" colspan="2">
                                        <span x-text="time"></span>
                                    </td>
                                </tr>
                            </template>    
                        </table>
                        <div class="m-3 p-3">
                            <p>Net Total: 
                                <span class="text-xl text-bold">$</span>
                                <span class="text-xl text-bold" id="total"></span>
                            </p>
                        </div>
                        
                        <!-- View rates button -->
                        <button
                        x-on:click="ratesPopUp = !ratesPopUp"
                        class="w-full py-3 font-medium tracking-widest text-white uppercase bg-slate-500 shadow-lg focus:outline-none hover:bg-slate-600 hover:shadow-none duration-200"
                        type="button">
                            View Rates
                        </button>
                        
                        <!-- Procees to payment Button -->
                        <button 
                        class="w-full py-3 mt-3 font-medium tracking-widest text-white uppercase bg-sky-500 shadow-lg focus:outline-none hover:bg-sky-600 hover:shadow-none duration-200"
                        type="button"
                        id="nextBtn"
                        x-on:click="goToCheckout()">
                            proceed
                        </button> 
                    </div>
                </div>
                
                <!-- Rates (Conditional) -->
                <div
                x-show="ratesPopUp"
                x-transition    
                class="fixed flex mx-auto w-max p-4 rounded border-2 border-slate-200 bg-white inset-0 items-center justify-center h-max my-auto shadow-2xl max-[815px]:mx-5 max-[815px]:">
                    <div
                    class="text-gray-700 uppercase text-bold">
                        <h3 class="text-2xl text-center">Rates</h3>
                        <p class="mt-3 text-center text-xs">
                            Note: All charges are on 
                            <span class="font-semibold">
                                hourly basis.
                            </span>
                        </p>
                        <p class="mb-3 text-center text-xs">
                            Peak hours: 
                            <span class="font-semibold">
                                10:00 to 13:00 and 15:00 to 18:00
                            </span>
                        </p>
                        <div class="grid grid-cols-2 justify-items-center">
                            <p class="text-left p-1 m-1 w-auto align-middle ">Adult (Resident)</p>
                            <p class="text-left p-1 m-1 w-auto  align-middle">$4</p>
                        </div>
                        <div class="grid grid-cols-2 justify-items-center">
                            <p class="text-left p-1 m-1 w-auto align-middle ">Adult (Resident-Peak)</p>
                            <p class="text-left p-1 m-1 w-auto  align-middle">$6</p>
                        </div>
                        <div class="grid grid-cols-2 justify-items-center">
                            <p class="text-left p-1 m-1 w-auto align-middle ">Child (Resident)</p>
                            <p class="text-left p-1 m-1 w-auto  align-middle">$2</p>
                        </div>
                        <div class="grid grid-cols-2 justify-items-center">
                            <p class="text-left p-1 m-1 w-auto align-middle ">Child (Resident-Peak)</p>
                            <p class="text-left p-1 m-1 w-auto  align-middle">$3</p>
                        </div>
                        <div class="grid grid-cols-2 justify-items-center">
                            <p class="text-left p-1 m-1 w-auto align-middle ">Adult (Foreign)</p>
                            <p class="text-left p-1 m-1 w-auto  align-middle">$10</p>
                        </div>
                        <div class="grid grid-cols-2 justify-items-center">
                            <p class="text-left p-1 m-1 w-auto align-middle ">Adult (Foreign-Peak)</p>
                            <p class="text-left  p-1 m-1 w-auto  align-middle">$13</p>
                        </div>
                        <div class="grid grid-cols-2 justify-items-center">
                            <p class="text-left p-1 m-1 w-auto align-middle ">Child (Foreign)</p>
                            <p class="text-left p-1 m-1 w-auto  align-middle">$5</p>
                        </div>
                        <div class="grid grid-cols-2 justify-items-center">
                            <p class="text-left p-1 m-1 w-auto align-middle ">Child (Foreign-Peak)</p>
                            <p class="text-left  p-1 m-1 w-auto  align-middle">$8</p>
                        </div>
                        <div class="grid grid-cols-2 justify-items-center">
                            <p class="text-left p-1 m-1 w-auto align-middle ">Infant</p>
                            <p class="text-left  p-1 m-1 w-auto  align-middle">free</p>
                        </div>
                        <button
                        x-on:click="ratesPopUp = !ratesPopUp"
                        class="w-full py-3 mt-5 font-medium tracking-widest text-white uppercase bg-slate-500 shadow-lg focus:outline-none hover:bg-slate-600 hover:shadow-none duration-200"
                        type="button">
                            Close Rates
                        </button>
                    </div>
                </div>
        </div>
        <script src="/js/tickets.js"></script>
    </body>
</html>